(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[959],{1524:(e,t,s)=>{Promise.resolve().then(s.bind(s,4124))},4003:(e,t,s)=>{"use strict";s.d(t,{U9:()=>r,iK:()=>a});let r=[{key:"wifi",label:"Wifi"},{key:"wc",label:"WC ri\xeang"},{key:"airCon",label:"M\xe1y lạnh"},{key:"parking",label:"Chỗ để xe"},{key:"kitchen",label:"Bếp"}],a={STUDENT:"STUDENT",LANDLORD:"LANDLORD"}},4124:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(5155),a=s(2115),n=s(6651),i=s(2529),l=s(5229),o=s(1456),c=s(6203);let d=s(5704).env.NEXT_PUBLIC_VIETMAP_API_KEY;function m(e){let{rooms:t}=e,n=(0,a.useRef)(null),i=(0,a.useRef)(null),[l,o]=(0,a.useState)(null),c=!d||0===d.length;return((0,a.useEffect)(()=>{s.e(258).then(s.t.bind(s,9743,23)).then(e=>{let t=e.default||e;t&&(t.accessToken=d,o(t))}).catch(e=>{console.error("Error loading Vietmap GL:",e)})},[]),(0,a.useEffect)(()=>{if(c||!l||!n.current)return;i.current||(i.current=new l.Map({container:n.current,style:"https://maps.vietmap.vn/styles/vietmap/style.json?apikey=".concat(d),center:[106.6297,10.8231],zoom:10}),i.current.addControl(new l.NavigationControl));let e=[];return t.forEach(t=>{if(!t.locationCoords)return;let s=new l.Popup({offset:25}).setHTML('\n        <div class="p-2">\n          <h3 class="font-bold">'.concat(t.title,"</h3>\n          <p>Gi\xe1: ").concat(t.price.toLocaleString("vi-VN")," VND</p>\n          <p>").concat(t.location,"</p>\n        </div>\n      ")),r=new l.Marker().setLngLat(t.locationCoords).setPopup(s).addTo(i.current);e.push(r)}),()=>e.forEach(e=>e.remove())},[t,l,c]),c)?(0,r.jsx)("div",{className:"w-full h-32 rounded-lg shadow mb-8 flex items-center justify-center bg-gray-50 text-gray-600 text-sm",children:"Kh\xf4ng thể tải bản đồ v\xec thiếu Vietmap API key. H\xe3y cấu h\xecnh NEXT_PUBLIC_VIETMAP_API_KEY."}):(0,r.jsx)("div",{ref:n,className:"w-full h-96 rounded-lg shadow mb-8"})}var x=s(3804);function h(e){let{room:t,onClose:s,onSave:n}=e,[i,o]=(0,a.useState)(5),[c,d]=(0,a.useState)(""),m=async e=>{e.preventDefault(),await n({roomId:t.id,rating:i,comment:c}),s()};return(0,r.jsx)("div",{className:"fixed inset-0 bg-black/25 flex items-center justify-center p-4 z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold",children:["Đ\xe1nh Gi\xe1 ",t.title]}),(0,r.jsx)("button",{onClick:s,children:(0,r.jsx)(l.A,{className:"w-5 h-5"})})]}),(0,r.jsxs)("form",{onSubmit:m,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Rating"}),(0,r.jsx)(x.A,{count:5,value:i,onChange:o,size:24})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-1",children:"B\xecnh luận"}),(0,r.jsx)("textarea",{value:c,onChange:e=>d(e.target.value),className:"w-full p-2 border rounded",rows:"4"})]}),(0,r.jsx)("button",{type:"submit",className:"w-full py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700",children:"Gửi"})]})]})})}var u=s(4003);function g(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)([]),[x,g]=(0,a.useState)({id:"U1",role:u.iK.STUDENT}),[b,f]=(0,a.useState)({location:"",minPrice:"",maxPrice:"",minArea:"",maxArea:"",amenities:[],showFavorites:!1}),[p,N]=(0,a.useState)(null),[j,y]=(0,a.useState)(null),v=x.role===u.iK.LANDLORD;(0,a.useEffect)(()=>{!async function(){try{let e=await fetch("".concat("http://localhost:3001","/rooms")),s=(await e.json()).rooms.map(e=>({...e,isFavorite:!1}));t(s)}catch(e){console.error("❌ Error fetching rooms:",e),t([])}}()},[]);let w=(0,a.useCallback)(async e=>{let r=s.includes(e);try{await fetch("".concat("http://localhost:3001","/favorites"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomId:e,add:!r})}),d(t=>r?t.filter(t=>t!==e):[...t,e]),t(t=>t.map(t=>t.id===e?{...t,isFavorite:!r}:t))}catch(e){console.error("Favorite error:",e)}},[s]),C=(0,a.useCallback)(async e=>{try{await fetch("".concat("http://localhost:3001","/rooms/").concat(e.roomId,"/reviews"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),N(null)}catch(e){console.error("Review error:",e)}},[]),k=(0,a.useMemo)(()=>e.filter(e=>!(b.location&&!e.location.toLowerCase().includes(b.location.toLowerCase())||b.minPrice&&e.price<Number(b.minPrice)||b.maxPrice&&e.price>Number(b.maxPrice)||b.minArea&&e.area<Number(b.minArea)||b.maxArea&&e.area>Number(b.maxArea))&&(!(b.amenities.length>0)||!!b.amenities.every(t=>e.amenities.includes(t)))&&(!b.showFavorites||!!s.includes(e.id))&&(!v||e.landlordId===x.id)),[e,b,s,v,x.id]),A=e=>{let{name:t,value:s}=e.target;f(e=>({...e,[t]:s}))};return(0,r.jsxs)("div",{className:"lg:flex lg:space-x-8",children:[(0,r.jsx)("div",{className:"lg:w-1/4 w-full mb-8 lg:mb-0",children:(0,r.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg sticky lg:top-24",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-800 mb-4 border-b pb-2 flex items-center",children:[(0,r.jsx)(n.A,{className:"w-5 h-5 mr-2 text-indigo-500"})," T\xecm kiếm & Lọc"]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Vị tr\xed (Quận/Huyện)"}),(0,r.jsx)("input",{type:"text",name:"location",value:b.location,onChange:A,placeholder:"VD: Quận 5, Thủ Đức",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Khoảng gi\xe1 (VNĐ)"}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("input",{type:"number",name:"minPrice",value:b.minPrice,onChange:A,placeholder:"Min",className:"w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"}),(0,r.jsx)("input",{type:"number",name:"maxPrice",value:b.maxPrice,onChange:A,placeholder:"Max",className:"w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Diện t\xedch (m\xb2)"}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsx)("input",{type:"number",name:"minArea",value:b.minArea,onChange:A,placeholder:"Min (m\xb2)",className:"w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"}),(0,r.jsx)("input",{type:"number",name:"maxArea",value:b.maxArea,onChange:A,placeholder:"Max (m\xb2)",className:"w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tiện \xedch"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:u.U9.map(e=>(0,r.jsxs)("button",{onClick:()=>{var t;return t=e.key,void f(e=>({...e,amenities:e.amenities.includes(t)?e.amenities.filter(e=>e!==t):[...e.amenities,t]}))},className:"flex items-center justify-center p-2 text-xs rounded-lg border transition ".concat(b.amenities.includes(e.key)?"bg-indigo-500 text-white border-indigo-500":"bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200"),children:[(0,r.jsx)(i.A,{className:"w-3 h-3 mr-1"})," ",e.label]},e.key))})]}),x.role===u.iK.STUDENT&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("label",{className:"flex items-center text-sm font-medium text-gray-700",children:[(0,r.jsx)("input",{type:"checkbox",checked:b.showFavorites,onChange:e=>f(t=>({...t,showFavorites:e.target.checked})),className:"rounded text-red-500 focus:ring-red-500 h-4 w-4 mr-2 border-gray-300"}),"Chỉ xem ph\xf2ng **Đ\xe3 Lưu** (",s.length,")"]})}),(0,r.jsxs)("button",{onClick:()=>{f({location:"",minPrice:"",maxPrice:"",minArea:"",maxArea:"",amenities:[],showFavorites:!1})},className:"w-full py-2 text-sm bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition font-medium border border-gray-300 flex items-center justify-center",children:[(0,r.jsx)(l.A,{className:"w-4 h-4 mr-1"})," X\xf3a bộ lọc"]})]})}),(0,r.jsxs)("div",{className:"lg:w-3/4 w-full",children:[(0,r.jsx)(m,{rooms:k}),(0,r.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6 flex items-center",children:[(0,r.jsx)(o.A,{className:"w-6 h-6 mr-2 text-indigo-500"}),v?"Ph\xf2ng trọ đ\xe3 đăng":"Danh s\xe1ch ph\xf2ng trọ"," (",k.length,")"]}),(0,r.jsx)("div",{className:"space-y-6",children:k.length>0?k.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsx)(c.A,{room:e,currentUserId:x.id,userRole:x.role,toggleFavorite:w,onEdit:()=>console.log("Edit:",e.id),onDelete:()=>console.log("Delete:",e.id),onChat:()=>N(e)}),(0,r.jsx)("button",{onClick:()=>N(e),className:"mt-2 text-sm text-indigo-600 hover:underline",children:"Viết đ\xe1nh gi\xe1"})]},e.id)):(0,r.jsxs)("div",{className:"text-center p-12 bg-white rounded-xl shadow-lg",children:[(0,r.jsx)("p",{className:"text-xl text-gray-500 font-medium",children:"Kh\xf4ng t\xecm thấy ph\xf2ng trọ n\xe0o ph\xf9 hợp."}),(0,r.jsx)("p",{className:"text-gray-400 mt-2",children:"H\xe3y thử điều chỉnh lại bộ lọc của bạn."})]})})]}),p&&(0,r.jsx)(h,{room:p,onClose:()=>N(null),onSave:C})]})}},6203:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var r=s(5155),a=s(2619),n=s.n(a),i=s(1873),l=s(7217),o=s(6154),c=s(1010),d=s(1360),m=s(3457),x=s(7586),h=s(4003);function u(e){var t;let{room:s,currentUserId:a,userRole:u,toggleFavorite:g,onEdit:b,onDelete:f,onChat:p}=e,N=s.landlordId===a&&u===h.iK.LANDLORD,j=s.isFavorite,y=h.U9.filter(e=>s.amenities.includes(e.key)).map(e=>e.label).join(", ");return(0,r.jsxs)("div",{className:"bg-white border border-gray-100 shadow-xl rounded-xl overflow-hidden hover:shadow-2xl transition duration-300 transform hover:-translate-y-1 flex flex-col md:flex-row",children:[(0,r.jsx)("div",{className:"md:w-1/3 w-full h-48 md:h-auto overflow-hidden",children:(0,r.jsx)("img",{src:s.imageUrl||(null==(t=s.images)?void 0:t[0]),alt:s.title||s.address,className:"w-full h-full object-cover transition duration-300 hover:scale-105",onError:e=>{e.target.onerror=null,e.target.src="https://placehold.co/400x300/CCCCCC/333333?text=No+Image"}})}),(0,r.jsxs)("div",{className:"md:w-2/3 p-4 flex flex-col justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:s.title||s.address}),(0,r.jsxs)("p",{className:"text-3xl font-extrabold text-indigo-600 mb-3",children:[new Intl.NumberFormat("vi-VN").format(s.price)," VNĐ",(0,r.jsx)("span",{className:"text-sm font-normal text-gray-500",children:"/th\xe1ng"})]}),(0,r.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,r.jsxs)("p",{className:"flex items-center",children:[(0,r.jsx)(i.A,{className:"w-4 h-4 mr-2 text-indigo-400"})," ",s.location||s.address]}),(0,r.jsxs)("p",{className:"flex items-center",children:[(0,r.jsx)(l.A,{className:"w-4 h-4 mr-2 text-indigo-400"})," ",s.area," m\xb2"]}),(0,r.jsxs)("p",{className:"flex items-center",children:[(0,r.jsx)(o.A,{className:"w-4 h-4 mr-2 text-indigo-400"})," Tiện \xedch: ",y||"Kh\xf4ng c\xf3"]})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[N?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>b(s),className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-green-500 rounded-lg hover:bg-green-600 transition",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 mr-1"})," Sửa"]}),(0,r.jsxs)("button",{onClick:()=>f(s.id),className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-red-500 rounded-lg hover:bg-red-600 transition",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 mr-1"})," X\xf3a"]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("button",{onClick:()=>g(s.id),className:"flex items-center px-4 py-2 text-sm font-medium rounded-lg transition ".concat(j?"bg-red-500 text-white hover:bg-red-600":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,r.jsx)(m.A,{className:"w-4 h-4 mr-1 ".concat(j?"fill-white":"text-red-500")}),j?"Đ\xe3 lưu":"Lưu"]}),(0,r.jsxs)("button",{onClick:()=>p(s),className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-500 rounded-lg hover:bg-indigo-600 transition",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 mr-1"})," Chat ngay"]})]}),(0,r.jsx)(n(),{href:"/room/".concat(s.id),children:(0,r.jsx)("button",{className:"flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition",children:"Xem Chi Tiết"})})]})]})]})}}},e=>{e.O(0,[297,473,441,255,358],()=>e(e.s=1524)),_N_E=e.O()}]);